{% extends 'base.html' %}
{% block content %}
<h2><a href="">Repetitorium der Physik</a></h2>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    
    td, th {
      border: 0px solid #dddddd;
      text-align: left;
      padding: 10px;
    }

    .trSpecial:hover {
      box-shadow:  0px 0px 12px 1px rgba(0,0,0,0.2); 
    }

    .selectTable:hover{
      background-color: rgb(207, 207, 207);
    }

    .popover{
        max-width: 75%; /* Max Width of the popover (depending on the container!) */
    }

    .hide{
      display:none;
    }
    </style>


    </head>
    <body>
      <h2>{{ mode }}</h2>

     
    
    <p>Suche</p>
    <input type='text' id='search'>

    <p>Filtern</p>
   

    <br>

  
    <label for='filter_course'>Kurs</label>
  <select id='filter_course' class="" style="width:auto;">
    <option value=''>--egal--</option>
    {% for course in courses %}
    <option>{{ course }}</option>
   {% endfor %}
  </select>

  <label for='filter_type'>Klausurtyp</label>
  <select id='filter_type' class="" style="width:auto;">
    <option value=''>--egal--</option>
    <option>Probeklausur</option>
    <option>Klausur </option> 
    <option>Wiederholungsklausur </option> 
  </select>

  <label for='filter_year'>Jahr</label>
  <select id='filter_year' class="" style="width:auto;">
    <option value=''>--egal--</option>
    <option>Default select dsfdfsdfsdfsdfsdfsdfsdfsdfsdfsdf</option>
    <option>Default </option> 
  </select> 

  <label for='filter_professor'>Dozent</label>
  <select id='filter_professor' class="" style="width:auto;">
    <option value=''>--egal--</option>
    <option>Default select</option>
    <option>Default </option> 
  </select> 

  <label for='filter_subjects'>Thema</label>
  <select id='filter_subjects' class="" style="width:auto;" multiple>
    {% for subject in subjects %}
    <option>{{ subject }}</option>
    {% endfor %}
  </select> 

  <label for='filter_difficulty'>Schwierigkeit</label>
  <select id='filter_difficulty' class="" style="width:auto;">
    <option value=''>--egal--</option>
    <option>Einfach </option> 
    <option>Mittel </option>
    <option>Schwer </option>
  </select> 

  <label for='filter_trial'>Bearbeitungsstatus</label>
  <select id='filter_trial' class="" style="width:auto;">
    <option value=''>--egal--</option>
    <option>Nicht Geschafft</option> 
    <option>Geschafft</option>
  </select> 


  
    <p>Sortieren</p>


    <button class='btn btn-primary' id='submit'>Submit</button>
    <br><br>

    {% if mode == 'Aufgabensammlung' %}
    <table id='query_result' >
      <tr>
        <th>Aufgabe</th>
        <th>Jahr</th>
        <th>Fach</th>
        <th>Professor</th>
        
        <th>Level</th>
        <th>Bearbeitungsstatus</th>
      </tr>
     
      {% for ex in exercises %}
      <tr class='trSpecial'>
        
        <td><a href='{% url "exercise_view" ex.pk %}' data-html='true' data-toggle="popover" title="{{ ex.name }}" 
          data-content='{{ ex.preview }} '
            id="popoverOption" class="btn" rel="popover"
            data-placement="right" data-original-title="{{ ex.name }}"><u>{{ ex.name }}</u></a></td>
        <td>{{ ex.year }}</td>
        <td>{{ ex.course }}</td>
        <td>
          {% for ex in ex.exam.all %}
        {{ ex.professor }}
        {% endfor %}
        </td>
        <td>{{ ex.difficulty | safe}}</td>
        <td>{{ ex.exam }}</td>

      </tr>
     {% endfor %}
    
    </table>
    
  {% else %}
  <table id='query_result' style='box-shadow:0px 0px 12px 1px rgba(0,0,0,0.2); padding:4px;' >
    <tr>
      <th></th>
      <th>Klausur</th>
     
    </tr>
   
    {% for exam in exams %}
    <tr class='trSpecial' >
      <td class='completed' value='{{exam.1}}' width='5%'>{{ exam.1 }}%</td>
      <td><a href='{% url "exam_view" exam.0.pk %}'><u> {{ exam.0 }}</u></a></td>
    </tr>
    
    <tr value='asdasdas' >
      <td ></td>
      <td >
        <div id='{{exam.0.pk}}' class='slide hide'>
          {% for exercise in exam.0.exercise_set.all %}
          <dl>
           {% if exercise in request.user.student.solved_exercises.all %} 
           &#x2705 {% endif %}
           {{ exercise }}
          </dl>
          
          {% endfor %}
          
        </div>
      </td>
    </tr>

    
      
    
  
   {% endfor %}
  
  </table>

  {% endif %}

  
      
      
      
<script>
//Percentage interpolation for completedness
$('.completed').attr('style', function(){
  console.log($(this).val());
  return 'color:#000000'
});
//$('.completed').attr('style','color:#ffffff')

//Slide Down of Exercises in Exam within table
$('tr').click(function(){
  $(this).next('tr').find('.slide').slideToggle();
})

//Preview of Exercise
$(document).ready(function(){
  $('[data-toggle="popover"]').popover();   
});

$('.btn').popover({ trigger: "hover" , html:true, sanitize:false });

//Search, Filter and Sort functionality of Exercises
$('#submit').click( function() {
    h('Das geht nicht');
    console.log($('#search').val());
    console.log($('#query_result').html());
    
    $.ajax({
      url:'Aufgabensammlung',
      data: {
        'search':$('#search').val(),

        'filter_course':$('#filter_course').val(),
        'filter_type':$('#filter_type').val(),
        'filter_year':$('#filter_year').val(),
        'filter_professor':$('#filter_professor').val(),
        'filter_subjects':$('#filter_subjects').val(),
      },
      dataType:'json',
      success: function(data){
        console.log(data);
        $('#query_result').html(data);
        $('.btn').popover({ trigger: "hover" });

      }
    })
  })



  $('#filter_type').click(function(){
    console.log($(this).val())
  })
</script>
    
{% endblock %}