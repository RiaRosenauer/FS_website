{% extends 'base.html' %}
{% block content %}

<script src="//mozilla.github.io/pdf.js/build/pdf.js"></script>

<script type="text/javascript" src="https://raw.github.com/mozilla/pdf.js/gh-pages/build/pdf.js"></script>

<script type="module">
    import { LaTeXJSComponent } from "https://cdn.jsdelivr.net/npm/latex.js/dist/latex.mjs"
    customElements.define("latex-js", LaTeXJSComponent)
  </script>

<title>LaTeX.js Web Component Test</title>

<style>
div.card {
  
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  text-align: center;
}

div.header {
  background-color: #4CAF50;
  color: white;
  padding: 10px;
  font-size: 40px;
}

div.container {
  padding: 10px;
}
</style>
</head>

<body>
    <a href='{% url "set_of_exercises_a" %}'>Zurück</a>
<center>

<h1>{{ exercise }}</h1>

<br>

<div class='btn btn-primary'>{% for exam in exams %}{{ exam.professor }}{% endfor %}</div>
<div class='btn btn-success'>{{ exercise.year }}</div>
<div class='btn btn-danger'>{{ exercise.course }}</div>

<div class='btn btn-light'>{{ exercise.difficulty | safe}}</div>

<br>
<br>

<div style='width:80vw'>
<canvas id="the-canvas"></canvas>
</div>
</center>
    <br>
    <br>

  
<button class='btn btn-light' id='solution_click'>Lösung</button>


{% if user.is_authenticated %}
{% if favourite_exercise%}
<button class='btn btn-primary active' id='favourite'>&#x2605;</button>
{%else%}
<button class='btn btn-light' id='favourite'>&#x2605;</button>
{%endif%}

<div class='btn-group btn-group-sm' id="solved_buttons"> 
{% if already_done%}
  {% if solved%}
    <button type='button' class='btn btn-primary active' id='solved'>Geschafft</button>
    <button type='button' class='btn btn-light' id='not_solved'>Wiederholen</button>
  {%else%}
    <button type='button' class='btn btn-light' id='solved'>Geschafft</button>
    <button type='button' class='btn btn-primary active' id='not_solved'>Wiederholen</button>
  {%endif%}
{%else%}
  <button type='button' class='btn btn-light' id='solved'>Geschafft</button>
  <button type='button' class='btn btn-light' id='not_solved'>Wiederholen</button>
{%endif%}
</div> 
{%endif%}


<div id='solution'  class='card' >
   <br><br>
   <center>
      <img src="{{ MEDIA_URL }}{{ exercise.answer }}">
   </center>
  
    <br><br>
</div>

<br><br><br><br>

<script>
$('#solution').hide();

$('#solution_click').click(function(){
    console.log('sdfsdf');
    $('#solution').slideToggle();

});



$('#favourite').click(function(){
    if ($(this).attr('class') == 'btn btn-primary active'){
      $(this).attr('class', 'btn btn-light')
      favourite = false
    } else{
      $(this).attr('class', 'btn btn-primary active')
      favourite = true
    }
    $.ajax({
      url:'favourite_ajax',
      data: {
        'favourite': favourite,
        'exercise': '{{exercise.pk}}',
      },
      dataType:'json',
    });

  });

  $('#solved').click(function(){
    $(this).attr('class', 'btn btn-primary active');
    $('#not_solved').attr('class', 'btn btn-light');


    $.ajax({
      url:'currentExercise_ajax',
      data: {
        'solved': true,
        'exercise': '{{exercise.pk}}',
      },
      dataType:'json',
    });
  });

  $('#not_solved').click(function(){
    $(this).attr('class', 'btn btn-primary active');
    $('#solved').attr('class', 'btn btn-light');

    $.ajax({
      url:'currentExercise_ajax',
      data: {
        'solved': false,
        'exercise': '{{exercise.pk}}',
      },
      dataType:'json',
    });
  });


  // If absolute URL from the remote server is provided, configure the CORS
// header on that server.
var url = "{{ MEDIA_URL }}{{ exercise.question }}";
// Loaded via <script> tag, create shortcut to access PDF.js exports.
  var pdfjsLib = window['pdfjs-dist/build/pdf'];

// The workerSrc property shall be specified.
pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';

// Asynchronous download of PDF
var loadingTask = pdfjsLib.getDocument(url);
loadingTask.promise.then(function(pdf) {
  console.log('PDF loaded');
  
  // Fetch the first page
  var pageNumber = 1;
  pdf.getPage(pageNumber).then(function(page) {
    console.log('Page loaded');
    
    var scale = 1.5;
    var viewport = page.getViewport({scale: scale});

    // Prepare canvas using PDF page dimensions
    var canvas = document.getElementById('the-canvas');
    var context = canvas.getContext('2d');
    canvas.height = viewport.height;
    canvas.width = viewport.width;

    // Render PDF page into canvas context
    var renderContext = {
      canvasContext: context,
      viewport: viewport
    };
    var renderTask = page.render(renderContext);
    renderTask.promise.then(function () {
      console.log('Page rendered');
    });
  });
}, function (reason) {
  // PDF loading error
  console.error(reason);
}); 

</script>




{% endblock %}